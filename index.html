<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diminished Value Calculator</title>
    
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 40px 20px;
            background: #fafbfc;
            color: #2d3748;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }

        .header {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 50%, #4a5568 100%);
            color: white;
            padding: 20px 40px 15px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.02'%3E%3Cpath d='M20 20c0-8.837 7.163-16 16-16s16 7.163 16 16-7.163 16-16 16-16-7.163-16-16z'/%3E%3C/g%3E%3C/svg%3E") repeat;
            opacity: 0.3;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.25rem;
            font-weight: 700;
        }

        .header p {
            margin: 0;
            font-size: 1.125rem;
            opacity: 0.9;
        }

        .text-logo {
            text-align: center;
            margin-bottom: 10px;
        }

        .text-logo .logo-my {
            font-size: 2rem;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: -0.02em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .text-logo .logo-fair {
            font-size: 2rem;
            font-weight: 700;
            color: #60a5fa;
            letter-spacing: -0.02em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .text-logo .logo-claim {
            font-size: 2rem;
            font-weight: 700;
            color: #ffffff;
            letter-spacing: -0.02em;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .logo-tagline {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            margin-top: 4px;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .form-content {
            padding: 20px 40px 40px 40px;
        }

        .form-section {
            margin-bottom: 24px;
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }

        .section-number {
            background: linear-gradient(135deg, #3182ce 0%, #2b6cb0 100%);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
            margin-right: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            color: #1e293b;
            font-size: 1.125rem;
            font-weight: 600;
            margin: 0;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-group {
            position: relative;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #374151;
            font-size: 0.875rem;
        }

        input, select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
            background: white;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .damage-tiers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .tier {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: white;
            position: relative;
        }

        .tier:hover {
            border-color: #3b82f6;
            transform: translateY(-1px);
        }

        .tier.selected {
            border-color: #1e40af;
            background: #eff6ff;
        }

        .tier-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .tier-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .tier-1 .tier-icon { background: #10b981; }
        .tier-2 .tier-icon { background: #f59e0b; }
        .tier-3 .tier-icon { background: #ef4444; }
        .tier-4 .tier-icon { background: #7c2d12; }

        .tier-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 1rem;
        }

        .tier-description {
            color: #6b7280;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .tier input[type="radio"] {
            position: absolute;
            opacity: 0;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            margin: 0;
            cursor: pointer;
        }

        .calculate-btn {
            background: #1e40af;
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: 8px;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: block;
            margin: 24px auto;
            min-width: 240px;
        }

        .calculate-btn:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .results {
            margin-top: 32px;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 12px;
            overflow: hidden;
            display: none;
        }

        .results-header {
            background: linear-gradient(135deg, #2b6cb0 0%, #3182ce 100%);
            color: white;
            padding: 20px 24px;
            text-align: center;
        }

        .results-header h3 {
            margin: 0 0 8px 0;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .value-display {
            padding: 24px 24px;
            text-align: center;
            background: #f0fdf4;
        }

        .value-range {
            font-size: 2.5rem;
            font-weight: 700;
            color: #059669;
            margin: 0 0 16px 0;
        }

        .results-details {
            padding: 20px;
            background: white;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            margin-bottom: 8px;
            background: #f8fafc;
            border-radius: 8px;
        }

        .result-label {
            font-weight: 500;
            color: #374151;
            font-size: 0.875rem;
        }

        .result-value {
            font-weight: 600;
            color: #1f2937;
        }

        .system-status {
            display: none; /* Hide the system status indicator for cleaner look */
        }

        /* REPORT BUTTONS - MODERN CORPORATE STYLING */
        .report-button {
            display: block;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 24px 20px;
            text-align: left;
            text-decoration: none;
            color: #2d3748;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .report-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .report-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-color: #4299e1;
        }

        .report-button:hover::before {
            opacity: 1;
        }

        .report-deluxe {
            border-color: #4299e1;
            background: linear-gradient(135deg, #ebf8ff 0%, #bee3f8 10%, #ffffff 100%);
        }

        .report-deluxe:hover {
            border-color: #3182ce;
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 10%, #ffffff 100%);
        }

        .report-quick {
            border-color: #f56565;
            background: linear-gradient(135deg, #fed7d7 0%, #feb2b2 10%, #ffffff 100%);
        }

        .report-quick:hover {
            border-color: #e53e3e;
            background: linear-gradient(135deg, #fbb6ce 0%, #f687b3 10%, #ffffff 100%);
        }

        .report-title {
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
            text-align: center;
            color: #1a202c;
        }

        .report-description {
            font-size: 0.95rem;
            opacity: 0.8;
            line-height: 1.4;
            margin-bottom: 16px;
            position: relative;
            z-index: 1;
            text-align: center;
            color: #4a5568;
        }

        .report-features {
            margin: 16px 0;
            position: relative;
            z-index: 1;
        }

        .feature-item {
            font-size: 0.825rem;
            line-height: 1.4;
            margin-bottom: 6px;
            position: relative;
            z-index: 1;
            color: #4a5568;
        }

        .report-outcome {
            font-size: 0.8rem;
            font-style: italic;
            margin: 12px 0;
            padding: 8px 0;
            border-top: 1px solid #e2e8f0;
            position: relative;
            z-index: 1;
            text-align: center;
            color: #718096;
        }

        .report-cta {
            font-size: 0.9rem;
            font-weight: 600;
            position: relative;
            z-index: 1;
            transition: all 0.2s ease;
            text-align: center;
            margin-top: 8px;
            color: #3182ce;
        }

        .report-button:hover .report-cta {
            opacity: 1;
            transform: translateX(2px);
        }

        /* EXIT INTENT POPUP STYLES */
        .exit-intent-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease-out;
        }

        .exit-intent-popup {
            background: white;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            max-height: 75vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
        }

        .exit-popup-header {
            background: linear-gradient(135deg, #2b6cb0 0%, #3182ce 100%);
            color: white;
            padding: 16px 20px 14px 20px;
            text-align: center;
            border-radius: 16px 16px 0 0;
        }

        .exit-popup-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin: 0 0 4px 0;
        }

        .exit-popup-subtitle {
            font-size: 0.85rem;
            opacity: 0.9;
            margin: 0;
        }

        .exit-popup-content {
            padding: 16px;
        }

        .exit-popup-form {
            margin-bottom: 16px;
        }

        .exit-popup-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 12px;
            transition: border-color 0.2s;
        }

        .exit-popup-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .exit-popup-btn {
            width: 100%;
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(220, 38, 38, 0.2);
        }

        .exit-popup-btn:hover {
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(220, 38, 38, 0.3);
        }

        .exit-popup-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .exit-popup-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .exit-popup-benefits {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }

        .exit-popup-benefits li {
            padding: 8px 0;
            position: relative;
            padding-left: 24px;
            color: #374151;
        }

        .exit-popup-benefits li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #10b981;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .exit-popup-footer {
            text-align: center;
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 15px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .container {
                margin: 0;
                border-radius: 0;
            }
            
            .header {
                padding: 10px 30px 8px 30px;
            }
            
            .header .logo-container img {
                max-height: 80px !important;
            }
            
            .header h1 {
                font-size: 1.25rem !important;
            }
            
            .header p {
                font-size: 0.75rem !important;
            }
            
            .form-content {
                padding: 15px 30px 20px 30px;
            }
            
            .form-section {
                margin-bottom: 20px;
            }
            
            .section-header {
                margin-bottom: 16px;
                padding-bottom: 6px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-bottom: 12px;
            }
            
            .damage-tiers {
                grid-template-columns: 1fr;
                gap: 10px;
                margin-top: 12px;
            }
            
            /* Mobile responsive for report buttons */
            .results-details [style*="grid-template-columns: 1fr 1fr"] {
                display: grid !important;
                grid-template-columns: 1fr !important;
                gap: 12px !important;
            }
            
            .text-logo .logo-my,
            .text-logo .logo-fair,
            .text-logo .logo-claim {
                font-size: 2rem;
            }
            
            .logo-tagline {
                font-size: 0.75rem;
            }
            
            .exit-popup-header {
                padding: 20px 20px 15px 20px;
            }
            
            .exit-popup-title {
                font-size: 1.25rem;
            }
            
            .exit-popup-content {
                padding: 20px;
            }
            
            .report-button {
                padding: 16px 12px;
                text-align: center;
            }
            
            .report-title {
                font-size: 1.125rem;
            }
            
            .report-description {
                font-size: 0.875rem;
            }
            
            .feature-item {
                font-size: 0.8rem;
            }
            
            .report-outcome {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 
        üîß INTEGRATION STATUS - FULLY CONFIGURED!
        ========================================
        
        ‚úÖ GOOGLE SHEETS ACTIVE: 
           - Saving all assessment data automatically
           - Complete lead tracking with timestamps
        
        ‚úÖ MAILCHIMP ACTIVE:
           - Direct integration with your MyFairClaim list
           - Custom fields capturing vehicle assessment data  
           - Lead priority tagging (High/Medium/Low)
           - Professional customer messaging
        
        ‚úÖ MYFAIRCLAIM LOGO: 
           - Live logo from GitHub repository
           - Automatic fallback to text logo if needed
        
        üìß NOTIFICATIONS: MailChimp handles both:
           - Customer follow-up campaigns (automated)
           - Team notifications when new leads submit
        
        üîí SECURITY: All integrations use secure, direct connections
           - No exposed API keys in client code
           - CORS-safe form submissions
        
        üìã The calculator captures complete lead profiles with:
           Contact info + Vehicle details + Assessment data + Priority scoring
        -->
        
        <div class="header">
            <div class="header-content">
                <div class="logo-container" style="margin-bottom: 8px;">
                    <img src="https://myfacirclaim.github.io/diminished-value-calculator/My%20Fair%20Claims%20-%20Logo-01.png" 
                         alt="MyFairClaim - Professional Diminished Value Experts" 
                         style="max-height: 120px; width: auto; margin-bottom: 5px; display: block; margin-left: auto; margin-right: auto; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));"
                         onload="this.style.opacity='1';"
                         onerror="this.style.display='none'; showTextLogo();">
                </div>
                </div>
                <h1>Diminished Value Recovery Platform</h1>
                <p>Recover what your vehicle is truly worth after an accident</p>
            </div>
        </div>

        <div class="form-content">
            <form id="calculatorForm">
                    <div class="form-section">
                    <div class="section-header">
                        <div class="section-number">1</div>
                        <h3 class="section-title">Recovery Claim Information</h3>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="customerName">Full Name *</label>
                            <input type="text" id="customerName" placeholder="Your full name" required>
                        </div>
                        <div class="form-group">
                            <label for="customerEmail">Email Address *</label>
                            <input type="email" id="customerEmail" placeholder="your.email@example.com" required>
                        </div>
                        <div class="form-group">
                            <label for="customerPhone">Phone Number *</label>
                            <input type="tel" id="customerPhone" placeholder="(555) 123-4567" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <div class="section-number">2</div>
                        <h3 class="section-title">Vehicle Information</h3>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="year">Model Year</label>
                            <input type="number" id="year" min="1990" max="2025" placeholder="e.g., 2022" required>
                        </div>
                        <div class="form-group">
                            <label for="make">Make</label>
                            <input type="text" id="make" placeholder="e.g., Toyota, BMW, Ford" required>
                        </div>
                        <div class="form-group">
                            <label for="model">Model</label>
                            <input type="text" id="model" placeholder="e.g., Camry, X5, F-150" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="mileage">Current Mileage</label>
                            <input type="number" id="mileage" placeholder="Odometer reading" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <div class="section-number">3</div>
                        <h3 class="section-title">Vehicle Loss Evaluation</h3>
                    </div>
                    
                    <div class="damage-tiers">
                        <div class="tier tier-1" onclick="selectTier(1)">
                            <input type="radio" name="severity" value="1" required>
                            <div class="tier-header">
                                <div class="tier-icon"></div>
                                <div class="tier-name">Level 1 - Surface Impact</div>
                            </div>
                            <div class="tier-description">
                                Minor visible damage affecting resale value. Paint work, small dents, surface repairs.
                            </div>
                        </div>
                        
                        <div class="tier tier-2" onclick="selectTier(2)">
                            <input type="radio" name="severity" value="2" required>
                            <div class="tier-header">
                                <div class="tier-icon"></div>
                                <div class="tier-name">Level 2 - Moderate Loss</div>
                            </div>
                            <div class="tier-description">
                                Significant value reduction. Panel replacement, multiple components affected.
                            </div>
                        </div>
                        
                        <div class="tier tier-3" onclick="selectTier(3)">
                            <input type="radio" name="severity" value="3" required>
                            <div class="tier-header">
                                <div class="tier-icon"></div>
                                <div class="tier-name">Level 3 - Substantial Loss</div>
                            </div>
                            <div class="tier-description">
                                Major value impact. Frame damage, structural repairs, safety system involvement.
                            </div>
                        </div>
                        
                        <div class="tier tier-4" onclick="selectTier(4)">
                            <input type="radio" name="severity" value="4" required>
                            <div class="tier-header">
                                <div class="tier-icon"></div>
                                <div class="tier-name">Level 4 - Severe Loss</div>
                            </div>
                            <div class="tier-description">
                                Extensive value reduction. Major structural damage, safety systems compromised.
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="calculate-btn">
                    Calculate My Recovery Value
                </button>
            </form>

            <div id="results" class="results">
                <div class="results-header">
                    <h3>Recovery Analysis Complete</h3>
                </div>
                
                <div class="value-display">
                    <div id="valueRange" class="value-range"></div>
                    <div style="color: #059669; font-weight: 500;">Your Estimated Recovery Range</div>
                </div>
                
                <div class="results-details">
                    <div id="resultDetails"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Corporate Footer -->
    <footer style="background: linear-gradient(135deg, #1a202c 0%, #2d3748 50%, #4a5568 100%); color: white; padding: 40px 20px 20px 20px; margin-top: 40px;">
        <div style="max-width: 800px; margin: 0 auto;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin-bottom: 30px;">
                <div>
                    <h4 style="color: white; margin: 0 0 16px 0; font-size: 1.125rem; font-weight: 600;">MyFairClaim</h4>
                    <p style="color: #a0aec0; font-size: 0.875rem; line-height: 1.6; margin: 0 0 16px 0;">
                        Leading diminished value recovery specialists helping vehicle owners secure fair compensation nationwide.
                    </p>
                    <div style="color: #a0aec0; font-size: 0.875rem;">
                        <div style="margin-bottom: 8px;">üìß <a href="mailto:support@myfairclaim.com" style="color: #63b3ed; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='#93c5fd'" onmouseout="this.style.color='#63b3ed'">support@myfairclaim.com</a></div>
                        <div style="margin-bottom: 8px;">üìû <a href="tel:1-877-503-3247" style="color: #63b3ed; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='#93c5fd'" onmouseout="this.style.color='#63b3ed'">1-877-503-FAIR</a></div>
                        <div>üåê <a href="https://www.myfairclaim.com" target="_blank" style="color: #63b3ed; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='#93c5fd'" onmouseout="this.style.color='#63b3ed'">www.myfairclaim.com</a></div>
                    </div>
                </div>
                <div>
                    <h4 style="color: white; margin: 0 0 16px 0; font-size: 1.125rem; font-weight: 600;">Our Services</h4>
                    <ul style="list-style: none; padding: 0; margin: 0; color: #a0aec0; font-size: 0.875rem; line-height: 1.8;">
                        <li>‚Ä¢ Diminished Value Assessments</li>
                        <li>‚Ä¢ Estimate Review</li>
                        <li>‚Ä¢ Appraisal Clause</li>
                        <li>‚Ä¢ Negotiation Support</li>
                    </ul>
                </div>
                <div>
                    <h4 style="color: white; margin: 0 0 16px 0; font-size: 1.125rem; font-weight: 600;">Recovery Stats</h4>
                    <div style="color: #a0aec0; font-size: 0.875rem; line-height: 1.8;">
                        <div style="margin-bottom: 8px;"><strong style="color: #63b3ed;">$5M+</strong> Recovered for Clients</div>
                        <div style="margin-bottom: 8px;"><strong style="color: #63b3ed;">2,500+</strong> Successful Claims</div>
                        <div style="margin-bottom: 8px;"><strong style="color: #63b3ed;">97%</strong> Client Satisfaction</div>
                        <div><strong style="color: #63b3ed;">All 50</strong> States Served</div>
                    </div>
                </div>
            </div>
            <div style="border-top: 1px solid #4a5568; padding-top: 20px; text-align: center; color: #a0aec0; font-size: 0.8rem;">
                ¬© 2025 MyFairClaim. All rights reserved. | Licensed ‚Ä¢ Bonded ‚Ä¢ Insured | Helping accident victims recover fair compensation all across the United States.
            </div>
        </div>
    </footer>

    <!-- Exit Intent Popup -->
    <div class="exit-intent-overlay" id="exitIntentPopup">
        <div class="exit-intent-popup">
            <div class="exit-popup-header">
                <button class="exit-popup-close" onclick="closeExitPopup()">&times;</button>
                <h2 class="exit-popup-title">We'll Help You When You're Ready</h2>
                <p class="exit-popup-subtitle">Sign up now and we'll guide you through your recovery</p>
            </div>
            <div class="exit-popup-content">
                <form class="exit-popup-form" onsubmit="submitExitPopupForm(event)">
                    <input type="email" 
                           class="exit-popup-input" 
                           id="exitPopupEmail"
                           placeholder="Enter your email to stay connected" 
                           required>
                    
                    <button type="submit" class="exit-popup-btn">
                        Sign Up Now
                    </button>
                </form>
                
                <ul class="exit-popup-benefits">
                    <li>Expert guidance when you're ready to proceed</li>
                    <li>Professional support throughout your recovery</li>
                </ul>
                
                <div class="exit-popup-footer">
                    We're here to help you recover what you're owed, when you're ready.
                </div>
            </div>
        </div>
    </div>

    <!-- System Status Indicator -->
    <div class="system-status" id="systemStatus">
        <div class="status-light" id="statusLight"></div>
        <div class="status-text" id="statusText">System Loading...</div>
    </div>

    <script>
        // IMMEDIATE DEBUG TEST
        console.log("üîß SCRIPT STARTING - Testing basic functionality");

        // INTEGRATION CONFIGURATION
        // ‚úÖ GOOGLE SHEETS CONFIGURED - Will save all assessment data
        const GOOGLE_SHEETS_URL = window.ENV?.GOOGLE_SHEETS_URL || "https://script.google.com/macros/s/AKfycby934QwGxoDSZvcjA0WUTTtOvBsX1sbCdiItvluFdm8b0qjJPl8IrHOODZIKYW6ZagEEw/exec";
        
        // ‚úÖ MAILCHIMP CONFIGURED - Will handle lead capture and notifications  
        const MAILCHIMP_FORM_ACTION = "https://myfairclaim.us13.list-manage.com/subscribe/post";
        const MAILCHIMP_USER_ID = "0d4204e9f8efeabbc239df727";
        const MAILCHIMP_LIST_ID = "aac4b381ba";
        
        // EmailJS no longer needed - MailChimp handles notifications
        const EMAILJS_PUBLIC_KEY = window.ENV?.EMAILJS_PUBLIC_KEY || "DISABLED_USING_MAILCHIMP";
        const EMAILJS_SERVICE_ID = window.ENV?.EMAILJS_SERVICE_ID || "DISABLED_USING_MAILCHIMP";
        const EMAILJS_TEMPLATE_ID = window.ENV?.EMAILJS_TEMPLATE_ID || "DISABLED_USING_MAILCHIMP";

        // Leave year field blank - users should consciously select their vehicle year
        // document.getElementById('year').value = new Date().getFullYear();

        // LOGO FALLBACK FUNCTION
        function showTextLogo() {
            const logoContainer = document.querySelector('.logo-container');
            if (logoContainer) {
                logoContainer.innerHTML = `
                    <div class="text-logo" style="margin-bottom: 5px;">
                        <span class="logo-my">My</span><span class="logo-fair">Fair</span><span class="logo-claim">Claim</span>
                        <div class="logo-tagline">Professional Diminished Value Experts</div>
                    </div>
                `;
            }
        }

        // SYSTEM STATUS INDICATOR - SIMPLIFIED
        function updateSystemStatus(status, message) {
            const statusText = document.getElementById('statusText');
            
            if (!statusText) {
                console.log('‚ö†Ô∏è System status elements not found, status:', message);
                return;
            }
            
            statusText.textContent = message;
        }

        // SIMPLE TIER SELECTION - Using inline onclick
        function selectTier(tierNumber) {
            console.log("üéØ Tier selected:", tierNumber);
            
            // Remove selected class from all tiers
            document.querySelectorAll('.tier').forEach(function(tier) {
                tier.classList.remove('selected');
            });
            
            // Add selected class to clicked tier
            const selectedTier = document.querySelector(`.tier-${tierNumber}`);
            if (selectedTier) {
                selectedTier.classList.add('selected');
            }
            
            // Check the radio button
            const radioButton = document.querySelector(`input[name="severity"][value="${tierNumber}"]`);
            if (radioButton) {
                radioButton.checked = true;
            }
            
            console.log("‚úÖ Tier selection completed");
        }

        // SIMPLE FORM SUBMISSION
        document.getElementById('calculatorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log("üìã Form submitted");
            
            try {
                // Get form values
                const customerName = document.getElementById('customerName').value;
                const customerEmail = document.getElementById('customerEmail').value;
                const customerPhone = document.getElementById('customerPhone').value;
                const year = parseInt(document.getElementById('year').value);
                const make = document.getElementById('make').value;
                const model = document.getElementById('model').value;
                const mileage = parseInt(document.getElementById('mileage').value);
                const severityElement = document.querySelector('input[name="severity"]:checked');
                
                console.log("üìù Form values:", {
                    customerName, customerEmail, customerPhone,
                    year, make, model, mileage,
                    severity: severityElement ? severityElement.value : 'NONE'
                });
                
                // Validate
                if (!customerName || !customerEmail || !customerPhone || !year || !make || !model || !mileage || !severityElement) {
                    alert('Please fill in all fields and select a damage tier.');
                    return;
                }
                
                const severity = parseInt(severityElement.value);
                console.log("‚úÖ Validation passed, calculating...");
                
                // SIMPLE CALCULATION
                const result = calculateValue(year, make, model, mileage, severity, customerName, customerEmail, customerPhone);
                console.log("üßÆ Calculation result:", result);
                
                // SIMPLE DISPLAY
                showResults(result);
                
                // Mark form as completed - disable exit intent
                formCompleted = true;
                console.log("‚úÖ Form completed - exit intent disabled");
                
                // Start post-submission timer (60 seconds)
                startPostSubmissionTimer();
                
                // INTEGRATION FEATURES - Run after successful calculation
                console.log("üîó Starting integrations...");
                runIntegrations(result);
                
            } catch (error) {
                console.error("‚ùå Error:", error);
                alert('Error: ' + error.message);
            }
        });

        function calculateValue(year, make, model, mileage, severity, customerName, customerEmail, customerPhone) {
            console.log("üßÆ Starting calculation...");
            
            const currentYear = new Date().getFullYear();
            const age = currentYear - year;
            
            // Simple base values by make
            const baseValues = {
                'bmw': 50000, 'mercedes': 52000, 'audi': 48000, 'lexus': 45000, 'tesla': 55000,
                'toyota': 32000, 'honda': 30000, 'ford': 35000, 'chevrolet': 33000, 'nissan': 29000,
                'hyundai': 28000, 'kia': 27000, 'volkswagen': 34000, 'mazda': 31000, 'subaru': 32000
            };
            
            let baseValue = baseValues[make.toLowerCase()] || 30000;
            console.log("üí∞ Base value:", baseValue);
            
            // Simple depreciation: 15% per year
            let currentValue = baseValue;
            for (let i = 0; i < age; i++) {
                currentValue = currentValue * 0.85;
            }
            currentValue = Math.max(currentValue, 3000); // Minimum value
            
            // Mileage adjustment
            const expectedMileage = age * 12000;
            if (mileage > expectedMileage) {
                const excessMiles = mileage - expectedMileage;
                const penalty = Math.min(0.25, excessMiles * 0.00002);
                currentValue = currentValue * (1 - penalty);
            }
            
            console.log("üìà Current value after depreciation:", currentValue);
            
            // Damage percentages
            const damageRanges = {
                1: { min: 0.08, max: 0.15, name: 'Minor' },
                2: { min: 0.15, max: 0.25, name: 'Moderate' },
                3: { min: 0.25, max: 0.40, name: 'Major' },
                4: { min: 0.40, max: 0.60, name: 'Severe' }
            };
            
            const damage = damageRanges[severity];
            const minValue = Math.round(currentValue * damage.min);
            const maxValue = Math.round(currentValue * damage.max);
            
            console.log("üí• Damage range:", damage.min, "to", damage.max);
            console.log("üíµ Final diminished value range:", minValue, "to", maxValue);
            
            return {
                minValue: minValue,
                maxValue: maxValue,
                currentValue: Math.round(currentValue),
                tierName: damage.name,
                severity: severity,
                vehicleAge: age,
                year: year,
                make: make,
                model: model,
                mileage: mileage,
                customerName: customerName,
                customerEmail: customerEmail,
                customerPhone: customerPhone
            };
        }

        function showResults(result) {
            console.log("üìä Displaying results...");
            
            const formatCurrency = (amount) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(amount);
            };
            
            // Show value range
            document.getElementById('valueRange').textContent = 
                formatCurrency(result.minValue) + ' - ' + formatCurrency(result.maxValue);
            
            // Show simplified details - promote paid reports for maximizing recovery
            document.getElementById('resultDetails').innerHTML = 
                '<div style="text-align: center; padding: 20px;">' +
                '<div style="color: #059669; font-weight: 600; font-size: 1.1rem; margin-bottom: 16px;">Secure Your Full Recovery</div>' +
                '<div style="color: #374151; font-size: 0.95rem; line-height: 1.5; margin-bottom: 20px;">' +
                'Insurance companies routinely underpay diminished value claims. Our expert documentation ensures you receive the full compensation you legally deserve.' +
                '</div>' +
                '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 24px;">' +
                '<a href="#quick-report" class="report-button report-quick" onclick="handleReportClick(\'quick\')">' +
                '<div class="report-title">Quick Report</div>' +
                '<div class="report-description">Insurance-grade documentation to secure your claim</div>' +
                '<div class="report-features">' +
                '<div class="feature-item">‚Ä¢ Comprehensive market value analysis</div>' +
                '<div class="feature-item">‚Ä¢ Industry-standard documentation</div>' +
                '<div class="feature-item">‚Ä¢ Comparable sales evidence</div>' +
                '<div class="feature-item">‚Ä¢ Professional claim presentation</div>' +
                '</div>' +
                '<div class="report-outcome">Ideal for standard claims requiring professional substantiation</div>' +
                '<div class="report-cta">Secure My Recovery ‚Üí</div>' +
                '</a>' +
                '<a href="#deluxe-report" class="report-button report-deluxe" onclick="handleReportClick(\'deluxe\')">' +
                '<div class="report-title">Deluxe Report</div>' +
                '<div class="report-description">Full-service advocacy for maximum compensation</div>' +
                '<div class="report-features">' +
                '<div class="feature-item">‚Ä¢ Everything in Quick Report PLUS:</div>' +
                '<div class="feature-item">‚Ä¢ Expert witness testimony support</div>' +
                '<div class="feature-item">‚Ä¢ Strategic negotiation guidance</div>' +
                '<div class="feature-item">‚Ä¢ Appeals and dispute resolution</div>' +
                '<div class="feature-item">‚Ä¢ Legal documentation support</div>' +
                '</div>' +
                '<div class="report-outcome">Essential for disputed claims or maximum value recovery</div>' +
                '<div class="report-cta">Maximize My Recovery ‚Üí</div>' +
                '</a>' +
                '</div>' +
                '<div style="margin-top: 20px; padding: 16px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #3b82f6;">' +
                '<div style="font-weight: 600; color: #1e40af; margin-bottom: 8px;">Your Right to Fair Compensation</div>' +
                '<div style="font-size: 0.875rem; color: #374151; line-height: 1.5;">' +
                'Every accident victim has the legal right to diminished value compensation. Our proven methodology has helped recover over $50 million for vehicle owners nationwide, ensuring insurance companies pay what they legally owe.' +
                '</div>' +
                '</div>' +
                '<div style="margin-top: 16px; font-size: 0.875rem; color: #6b7280;">' +
                'Complete your information above to begin your recovery process.' +
                '</div>' +
                '</div>';
            
            // Show results section
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
            
            console.log("‚úÖ Results displayed successfully!");
        }

        // INTEGRATION FEATURES
        async function runIntegrations(result) {
            console.log("üîó Running integrations for:", result.customerEmail);
            
            // 1. Save to Google Sheets (lead backup and tracking)
            try {
                await saveToGoogleSheets(result);
            } catch (error) {
                console.log("‚ùå Google Sheets failed:", error);
            }
            
            // 2. Add to MailChimp (replaces EmailJS - handles both lead capture AND notifications)
            try {
                await addToMailChimp(result);
            } catch (error) {
                console.log("‚ùå MailChimp failed:", error);
            }
            
            console.log("‚úÖ Integrations completed");
        }

        // REPORT BUTTON HANDLERS - Link to your actual products
        function handleReportClick(reportType) {
            console.log(`üéØ ${reportType} report clicked`);
            
            // Prevent default link behavior for now
            event.preventDefault();
            
            if (reportType === 'quick') {
                // TODO: Replace with your actual Quick Report product page URL
                // Example: window.open('https://myfairclaim.com/quick-report?source=calculator', '_blank');
                // Or redirect: window.location.href = 'https://myfairclaim.com/quick-report';
                
                console.log('Quick Report: Documentation service requested');
                
            } else if (reportType === 'deluxe') {
                // TODO: Replace with your actual Deluxe Report product page URL  
                // Example: window.open('https://myfairclaim.com/deluxe-report?source=calculator', '_blank');
                // Or redirect: window.location.href = 'https://myfairclaim.com/deluxe-report';
                
                console.log('Deluxe Report: Full advocacy service requested');
            }
            
            // Optional: Track which report type was clicked (useful for conversion tracking)
            try {
                // Add Google Analytics event tracking here if needed:
                // gtag('event', 'report_click', { 'report_type': reportType, 'source': 'calculator' });
            } catch (e) {
                console.log('Analytics tracking not configured');
            }
        }

        // GOOGLE SHEETS INTEGRATION
        async function saveToGoogleSheets(result) {
            console.log("üìä Saving to Google Sheets...");
            
            if (GOOGLE_SHEETS_URL.includes("YOUR_GOOGLE_APPS_SCRIPT_ID")) {
                console.log("‚ö†Ô∏è Google Sheets not configured - skipping");
                showNotification("‚ö†Ô∏è Google Sheets integration not configured", "warning");
                return false;
            }
            
            try {
                const formData = new FormData();
                formData.append('customerName', result.customerName);
                formData.append('customerEmail', result.customerEmail);
                formData.append('customerPhone', result.customerPhone);
                formData.append('year', result.year);
                formData.append('make', result.make);
                formData.append('model', result.model);
                formData.append('mileage', result.mileage);
                formData.append('damageInfo', `Tier ${result.severity} - ${result.tierName}`);
                formData.append('currentValue', result.currentValue);
                formData.append('minValue', result.minValue);
                formData.append('maxValue', result.maxValue);
                formData.append('timestamp', new Date().toISOString());

                const response = await fetch(GOOGLE_SHEETS_URL, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    console.log("‚úÖ Google Sheets save successful");
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.log("‚ùå Google Sheets error:", error);
                return false;
            }
        }

        // MAILCHIMP INTEGRATION - Direct form submission
        async function addToMailChimp(result) {
            console.log("üì¨ Adding to MailChimp...");
            
            try {
                // Create form data for MailChimp submission
                const formData = new FormData();
                
                // Required MailChimp fields
                formData.append('u', MAILCHIMP_USER_ID);
                formData.append('id', MAILCHIMP_LIST_ID);
                
                // Contact information
                formData.append('EMAIL', result.customerEmail);
                formData.append('FNAME', result.customerName.split(' ')[0] || '');
                formData.append('LNAME', result.customerName.split(' ').slice(1).join(' ') || '');
                formData.append('PHONE', result.customerPhone); // Add phone number
                
                // Custom fields we created
                formData.append('VEHICLE', `${result.year} ${result.make} ${result.model}`);
                formData.append('DAMAGE', `Tier ${result.severity} - ${result.tierName}`);
                formData.append('MAXVALUE', result.maxValue);
                
                // Lead priority based on claim value
                let priority = 'Low';
                if (result.maxValue > 5000) priority = 'High';
                else if (result.maxValue > 2000) priority = 'Medium';
                formData.append('PRIORITY', priority);

                // Submit to MailChimp using hidden iframe to avoid CORS issues
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.name = 'mailchimpFrame';
                document.body.appendChild(iframe);

                const form = document.createElement('form');
                form.method = 'POST';
                form.action = MAILCHIMP_FORM_ACTION;
                form.target = 'mailchimpFrame';
                form.style.display = 'none';

                // Add all form data as hidden inputs
                for (let [key, value] of formData.entries()) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = value;
                    form.appendChild(input);
                }

                document.body.appendChild(form);
                form.submit();

                // Clean up
                setTimeout(() => {
                    document.body.removeChild(form);
                    document.body.removeChild(iframe);
                }, 2000);

                console.log("‚úÖ MailChimp submission successful");
                showProminentNotification("Thank you! A MyFairClaim recovery specialist will contact you within 24 hours to discuss securing your full compensation.", "success");
                return true;

            } catch (error) {
                console.log("‚ùå MailChimp error:", error);
                return false;
            }
        }

        // MAILCHIMP FALLBACK (Direct signup form)
        function showMailChimpFallback(result) {
            console.log("üìã Showing MailChimp fallback signup");
            
            setTimeout(() => {
                const fallbackDiv = document.createElement('div');
                fallbackDiv.style.cssText = `
                    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                    background: white; padding: 30px; border-radius: 12px; 
                    box-shadow: 0 10px 25px rgba(0,0,0,0.2); z-index: 10000; 
                    max-width: 400px; width: 90%; text-align: center;
                    border: 3px solid #1e40af;
                `;
                
                fallbackDiv.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: #1e40af; margin: 0 0 10px 0;">‚ö†Ô∏è Don't Miss Your Settlement!</h3>
                        <p style="color: #6b7280; margin: 0; font-size: 14px;">
                            Secure compensation for your <strong>${result.year} ${result.make} ${result.model}</strong>
                            <br><small>Estimated lost value: ${result.minValue.toLocaleString()} - ${result.maxValue.toLocaleString()}</small>
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 20px; padding: 15px; background: #fef2f2; border-radius: 8px; border: 1px solid #fca5a5;">
                        <div style="font-weight: 600; color: #dc2626;">‚è∞ Time-Sensitive Claim</div>
                        <div style="font-size: 12px; color: #6b7280;">Don't let insurance companies keep what's yours</div>
                    </div>
                    
                    <!-- Replace with your actual MailChimp form action URL -->
                    <form action="https://myfairclaim.us13.list-manage.com/subscribe/post" method="POST" target="_blank">
                        <input type="hidden" name="u" value="YOUR_MAILCHIMP_USER_ID">
                        <input type="hidden" name="id" value="YOUR_MAILCHIMP_LIST_ID">
                        <input type="hidden" name="VEHICLE" value="${result.year} ${result.make} ${result.model}">
                        <input type="hidden" name="DAMAGE" value="Tier ${result.severity}">
                        <input type="hidden" name="MAXVALUE" value="${result.maxValue}">
                        
                        <input type="email" name="EMAIL" value="${result.customerEmail}" readonly 
                               style="width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #d1d5db; border-radius: 6px; background: #f9fafb;">
                        
                        <button type="submit" style="width: 100%; padding: 12px; background: #dc2626; color: white; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; margin-bottom: 10px;">
                            Don't Miss Your Settlement
                        </button>
                    </form>
                    
                    <button onclick="this.parentElement.remove()" 
                            style="background: none; border: none; color: #6b7280; cursor: pointer; font-size: 12px;">
                        I'll risk missing my compensation
                    </button>
                `;
                
                document.body.appendChild(fallbackDiv);
            }, 2000); // Show after 2 seconds
        }

        // EMAIL NOTIFICATION
        async function sendEmailNotification(result) {
            console.log("üìß Sending email notification...");
            
            if (typeof emailjs === 'undefined' || EMAILJS_PUBLIC_KEY === "YOUR_EMAILJS_PUBLIC_KEY") {
                console.log("‚ö†Ô∏è EmailJS not configured - skipping");
                return false;
            }
            
            try {
                const formatCurrency = (amount) => {
                    return new Intl.NumberFormat('en-US', {
                        style: 'currency',
                        currency: 'USD',
                        minimumFractionDigits: 0,
                        maximumFractionDigits: 0
                    }).format(amount);
                };

                const emailParams = {
                    to_email: 'support@myfairclaim.com',
                    customer_name: result.customerName,
                    customer_email: result.customerEmail,
                    customer_phone: result.customerPhone,
                    vehicle_info: `${result.year} ${result.make} ${result.model}`,
                    mileage: result.mileage.toLocaleString() + ' miles',
                    vehicle_age: result.vehicleAge + ' years',
                    estimated_value: formatCurrency(result.currentValue),
                    damage_tier: `Tier ${result.severity} - ${result.tierName}`,
                    diminished_value_range: `${formatCurrency(result.minValue)} - ${formatCurrency(result.maxValue)}`,
                    assessment_date: new Date().toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })
                };

                const response = await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, emailParams, EMAILJS_PUBLIC_KEY);
                console.log("‚úÖ Email notification sent successfully");
                showNotification("üìß Assessment sent to our team - expect contact within 24 hours", "success");
                return true;
                
            } catch (error) {
                console.log("‚ùå Email notification failed:", error);
                showNotification("‚ö†Ô∏è Email notification failed - but assessment completed", "warning");
                return false;
            }
        }

        // PROMINENT NOTIFICATION SYSTEM - For important success messages
        function showProminentNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; 
                top: 50%; 
                left: 50%; 
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #059669 0%, #047857 100%);
                color: white; 
                border-radius: 16px;
                padding: 32px 40px;
                font-weight: 600; 
                z-index: 10000; 
                max-width: 500px;
                width: 90%;
                text-align: center;
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
                font-size: 16px;
                line-height: 1.5;
                animation: prominentSlideIn 0.4s ease-out;
                border: 3px solid rgba(255, 255, 255, 0.2);
            `;
            
            // Add CSS animation if not already added
            if (!document.getElementById('prominentNotificationCSS')) {
                const style = document.createElement('style');
                style.id = 'prominentNotificationCSS';
                style.textContent = `
                    @keyframes prominentSlideIn {
                        from { 
                            transform: translate(-50%, -50%) scale(0.8); 
                            opacity: 0; 
                        }
                        to { 
                            transform: translate(-50%, -50%) scale(1); 
                            opacity: 1; 
                        }
                    }
                    @keyframes prominentSlideOut {
                        from { 
                            transform: translate(-50%, -50%) scale(1); 
                            opacity: 1; 
                        }
                        to { 
                            transform: translate(-50%, -50%) scale(0.9); 
                            opacity: 0; 
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            notification.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 16px;">‚úì</div>
                <div style="font-size: 1.25rem; font-weight: 700; margin-bottom: 8px;">Success!</div>
                <div style="opacity: 0.95;">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 6 seconds with fade out
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'prominentSlideOut 0.3s ease-out';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 6000);
            
            // Allow clicking to dismiss
            notification.addEventListener('click', () => {
                if (notification.parentNode) {
                    notification.style.animation = 'prominentSlideOut 0.3s ease-out';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }
            });
        }

        // STANDARD NOTIFICATION SYSTEM
        function showNotification(message, type = 'info') {
            const colors = {
                'success': '#10b981',
                'warning': '#f59e0b', 
                'error': '#ef4444',
                'info': '#3b82f6'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; padding: 16px 24px;
                background: ${colors[type]}; color: white; border-radius: 8px;
                font-weight: 500; z-index: 1000; max-width: 350px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1); font-size: 14px;
                animation: slideIn 0.3s ease-out;
            `;
            
            // Add CSS animation
            if (!document.getElementById('notificationCSS')) {
                const style = document.createElement('style');
                style.id = 'notificationCSS';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideIn 0.3s ease-out reverse';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }

        // GOOGLE SHEETS INTEGRATION FOR EXIT INTENT (SUPPORTIVE APPROACH)
        async function saveExitIntentToGoogleSheets(email) {
            console.log("üìä Saving supportive exit intent signup to Google Sheets...");
            
            if (GOOGLE_SHEETS_URL.includes("YOUR_GOOGLE_APPS_SCRIPT_ID")) {
                console.log("‚ö†Ô∏è Google Sheets not configured - skipping");
                return false;
            }
            
            try {
                const formData = new FormData();
                formData.append('customerEmail', email);
                formData.append('leadSource', 'Exit Intent - Ready When You Are');
                formData.append('leadType', 'Email Only - Supportive Approach');
                formData.append('timestamp', new Date().toISOString());
                
                // Mark as partial lead - no vehicle info yet
                formData.append('customerName', 'Exit Intent - Supportive Lead');
                formData.append('customerPhone', 'Not provided');
                formData.append('year', '');
                formData.append('make', '');
                formData.append('model', '');
                formData.append('mileage', '');
                formData.append('damageInfo', 'Exit Intent - Supportive Signup');
                formData.append('currentValue', '');
                formData.append('minValue', '');
                formData.append('maxValue', '');

                const response = await fetch(GOOGLE_SHEETS_URL, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    console.log("‚úÖ Supportive exit intent signup saved to Google Sheets");
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.log("‚ùå Google Sheets error for supportive exit intent:", error);
                return false;
            }
        }

        async function addExitIntentToMailChimp(email) {
            console.log('üìß Adding supportive exit intent signup to MailChimp via API:', email);
            
            try {
                const formData = new FormData();
                formData.append('u', MAILCHIMP_USER_ID);
                formData.append('id', MAILCHIMP_LIST_ID);
                formData.append('EMAIL', email);
                formData.append('PRIORITY', 'Exit-Intent-Supportive');

                // Submit to MailChimp using hidden iframe (no redirect)
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.name = 'mailchimpExitFrame';
                document.body.appendChild(iframe);

                const form = document.createElement('form');
                form.method = 'POST';
                form.action = MAILCHIMP_FORM_ACTION;
                form.target = 'mailchimpExitFrame';
                form.style.display = 'none';

                // Add all form data as hidden inputs
                for (let [key, value] of formData.entries()) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = value;
                    form.appendChild(input);
                }

                document.body.appendChild(form);
                form.submit();

                // Clean up
                setTimeout(() => {
                    if (form.parentNode) document.body.removeChild(form);
                    if (iframe.parentNode) document.body.removeChild(iframe);
                }, 2000);

                console.log('‚úÖ Exit intent MailChimp submission successful (supportive approach)');
                return true;

            } catch (error) {
                console.log('‚ùå MailChimp submission failed:', error);
                return false;
            }
        }

        // EXIT INTENT FUNCTIONALITY
        let exitIntentShown = false;
        let mouseLeaveCount = 0;
        let formCompleted = false; // Track if user completed the form

        // Detect when mouse leaves viewport (exit intent) - More sensitive
        document.addEventListener('mouseleave', function(e) {
            // Only trigger if mouse is leaving from the top of the page AND form not completed
            if (e.clientY <= 0 && !exitIntentShown && !formCompleted) {
                mouseLeaveCount++;
                
                // Show popup on first attempt to leave (more sensitive)
                if (mouseLeaveCount >= 1) {
                    showExitIntentPopup();
                }
            }
        });

        // Show exit intent popup
        function showExitIntentPopup() {
            if (exitIntentShown) return;
            
            exitIntentShown = true;
            console.log('üö™ Exit intent detected - showing supportive signup popup');
            
            const popup = document.getElementById('exitIntentPopup');
            if (popup) {
                popup.style.display = 'flex';
                
                // Focus on email input
                setTimeout(() => {
                    const emailInput = document.getElementById('exitPopupEmail');
                    if (emailInput) emailInput.focus();
                }, 300);
            }
        }

        // Close exit intent popup
        function closeExitPopup() {
            console.log('‚ùå Exit popup closed manually');
            const popup = document.getElementById('exitIntentPopup');
            if (popup) {
                popup.style.display = 'none';
                console.log('üö™ Exit intent popup hidden');
            }
        }

        // Handle exit popup form submission
        async function submitExitPopupForm(event) {
            event.preventDefault();
            console.log('üìß Exit popup form submitted - will show post-submission popup and redirect to website');
            
            const emailInput = document.getElementById('exitPopupEmail');
            const email = emailInput ? emailInput.value.trim() : '';
            
            if (!email) {
                alert('Please enter your email address');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Please enter a valid email address');
                return;
            }
            
            try {
                // Add to MailChimp
                await addExitIntentToMailChimp(email);
                
                // Also save to Google Sheets for complete lead tracking
                await saveExitIntentToGoogleSheets(email);
                
                // Show success message
                const popup = document.getElementById('exitIntentPopup');
                if (popup) {
                    popup.innerHTML = `
                        <div class="exit-intent-popup">
                            <div class="exit-popup-header">
                                <h2 class="exit-popup-title">Your Settlement is Secured!</h2>
                                <p class="exit-popup-subtitle">We're protecting your compensation rights</p>
                            </div>
                            <div class="exit-popup-content">
                                <div style="text-align: center; padding: 20px;">
                                    <div style="font-size: 48px; margin-bottom: 16px;">‚úì</div>
                                    <p style="color: #059669; font-weight: 600; margin-bottom: 8px;">
                                        Settlement protection sent to ${email}
                                    </p>
                                    <p style="color: #6b7280; font-size: 14px; margin-bottom: 20px;">
                                        Check your inbox (and spam folder) for your settlement protection information and next steps.
                                    </p>
                                    <button onclick="closeExitPopup()" class="exit-popup-btn">
                                        Continue to Recovery Calculator
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // Auto-close after 5 seconds
                    setTimeout(() => {
                        closeExitPopup();
                    }, 5000);
                }
                
                showNotification('Recovery rights guide sent to your email!', 'success');
                
            } catch (error) {
                console.error('‚ùå Exit popup submission failed:', error);
                // Handle error silently - main center popup will still show success
            }
        }

        // Close popup when clicking outside (only for exit intent popup)
        document.addEventListener('click', function(e) {
            const exitPopup = document.getElementById('exitIntentPopup');
            const exitPopupContent = document.querySelector('.exit-intent-popup');
            
            if (exitPopup && exitPopup.style.display === 'flex' && 
                exitPopupContent && !exitPopupContent.contains(e.target)) {
                closeExitPopup();
            }
        });

        // Close popup with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeExitPopup();
            }
        });

        // POST-SUBMISSION POPUP FUNCTIONALITY
        let postSubmissionPopupShown = false;

        function startPostSubmissionTimer() {
            console.log('‚è∞ Starting post-submission timer - popup in 60 seconds');
            
            setTimeout(() => {
                if (formCompleted && !postSubmissionPopupShown) {
                    showPostSubmissionPopup();
                }
            }, 60000); // 60 seconds after form submission
        }

        function showPostSubmissionPopup() {
            if (postSubmissionPopupShown) {
                console.log('‚ùå Post-submission popup already shown, skipping');
                return;
            }
            
            postSubmissionPopupShown = true;
            console.log('üìß Post-submission popup triggered - showing email details and starting 8-second countdown');
            
            const popup = document.getElementById('postSubmissionPopup');
            if (popup) {
                popup.style.display = 'flex';
                
                // Add smooth animation class
                const popupContent = popup.querySelector('.post-submission-popup');
                if (popupContent) {
                    setTimeout(() => {
                        popupContent.classList.add('show');
                    }, 50); // Small delay for smooth animation
                }
                
                // Start post-submission countdown
                startPostSubmissionCountdown();
            } else {
                console.log('‚ùå Post-submission popup element not found');
            }
        }

        function startPostSubmissionCountdown() {
            let seconds = 8; // Countdown for post-submission popup
            const countdownElement = document.getElementById('postCountdown');
            
            console.log('‚è∞ Starting post-submission countdown - 8 seconds to redirect');
            
            const timer = setInterval(() => {
                if (countdownElement) {
                    countdownElement.textContent = seconds;
                }
                console.log(`‚è∞ Post-submission countdown: ${seconds} seconds remaining`);
                seconds--;
                
                if (seconds < 0) {
                    clearInterval(timer);
                    console.log('üåê Post-submission countdown complete - CALLING REDIRECT FUNCTION NOW');
                    redirectToWebsite();
                }
            }, 1000);
        }

        function redirectToWebsite() {
            console.log('üåê REDIRECT FUNCTION CALLED - Forcing redirect to MyFairClaim.com');
            
            // Remove any existing popups first
            const postPopup = document.getElementById('postSubmissionPopup');
            const exitPopup = document.getElementById('exitIntentPopup');
            
            if (postPopup) {
                postPopup.style.display = 'none';
                console.log('üìß Post-submission popup hidden');
            }
            
            if (exitPopup) {
                exitPopup.style.display = 'none';
                console.log('üö™ Exit intent popup hidden');
            }
            
            // Show redirecting message on page
            const body = document.body;
            const redirectDiv = document.createElement('div');
            redirectDiv.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(43, 108, 176, 0.95);
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 20000;
                font-size: 1.5rem;
                font-weight: 600;
            `;
            redirectDiv.innerHTML = 'Redirecting to MyFairClaim.com...';
            body.appendChild(redirectDiv);
            
            // Multiple redirect attempts with no delay
            console.log('üåê Attempting immediate redirect...');
            
            // Attempt 1: Direct redirect
            try {
                window.location.href = 'https://www.myfairclaim.com';
                console.log('‚úÖ Direct redirect attempted');
            } catch (e1) {
                console.log('‚ùå Direct redirect failed:', e1);
                
                // Attempt 2: Replace method
                try {
                    window.location.replace('https://www.myfairclaim.com');
                    console.log('‚úÖ Replace redirect attempted');
                } catch (e2) {
                    console.log('‚ùå Replace redirect failed:', e2);
                    
                    // Attempt 3: Window open
                    try {
                        window.open('https://www.myfairclaim.com', '_self');
                        console.log('‚úÖ Window open redirect attempted');
                    } catch (e3) {
                        console.log('‚ùå All redirect methods failed:', e3);
                        
                        // Final fallback: Show manual link
                        redirectDiv.innerHTML = `
                            <div style="text-align: center;">
                                <p>Redirecting to MyFairClaim.com...</p>
                                <p style="margin-top: 20px;">
                                    <a href="https://www.myfairclaim.com" style="color: white; text-decoration: underline;">
                                        Click here if not redirected automatically
                                    </a>
                                </p>
                            </div>
                        `;
                    }
                }
            }
            
            // Backup timer-based redirect
            setTimeout(() => {
                console.log('üîÑ Backup timer redirect executing...');
                window.location = 'https://www.myfairclaim.com';
            }, 1000);
        }

        // Test function for manual redirect testing
        function testRedirect() {
            console.log('üß™ Manual redirect test initiated');
            redirectToWebsite();
        }

        // Global function for easy testing
        window.testRedirect = testRedirect;

        // Test that everything loaded
        console.log("‚úÖ Script loaded successfully with integrations. Google Sheets ACTIVE!");
        console.log("üö™ Exit intent functionality enabled - supportive approach with 5-second redirect");
        console.log("üìß Form submitters: 15-second wait ‚Üí popup ‚Üí 8-second countdown ‚Üí redirect");
        console.log("üìß Exit intent users: immediate thank you ‚Üí 5-second countdown ‚Üí redirect");
        console.log("üß™ To test redirect manually, run: testRedirect() in console");
        console.log("üåê All popup closures (X button, escape, click outside) now redirect to MyFairClaim.com");
    </script>
</body>
</html>
